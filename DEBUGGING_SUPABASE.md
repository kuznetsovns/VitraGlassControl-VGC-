# –û—Ç–ª–∞–¥–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Supabase

## –ü—Ä–æ–±–ª–µ–º–∞
–î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase, —Ö–æ—Ç—è –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase (‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç)
- –°–æ–∑–¥–∞–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã `test-supabase.js` –∏ `test-objects.js`
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —á—Ç–æ Supabase —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –¢–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –≤–∏—Ç—Ä–∞–∂–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ console.log:

**src/services/placedVitrageStorage.ts**:
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏–º—è –≤–∏—Ç—Ä–∞–∂–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –í—ã–≤–æ–¥—è—Ç—Å—è –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è (id, object_id, floor_plan_id, vitrage_id, position)
- –î–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ Supabase
- –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏

**src/components/FloorPlanEditor/FloorPlanEditor.tsx**:
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è selectedObject –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è currentPlan
- –í—ã–≤–æ–¥—è—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º placedVitrageStorage.create

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```
http://localhost:5173
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
- –ù–∞–∂–º–∏—Ç–µ F12
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console

### 3. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤–∏—Ç—Ä–∞–∂ –Ω–∞ –ø–ª–∞–Ω–µ —ç—Ç–∞–∂–∞
1. –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ü–ª–∞–Ω —ç—Ç–∞–∂–µ–π"
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω —ç—Ç–∞–∂–∞ (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π)
4. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ç—Ä–∞–∂"
5. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏—Ç—Ä–∞–∂ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
6. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–ª–∞–Ω —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
–ò—â–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:**
```
üè¢ Selected object: { id: "...", name: "..." }
üìç Current plan: { id: "...", name: "..." }
üîç About to call placedVitrageStorage.create with data: {...}
üìù Creating placed vitrage: –ù–∞–∑–≤–∞–Ω–∏–µ_–í–∏—Ç—Ä–∞–∂–∞
üìã Vitrage data: { object_id: "...", floor_plan_id: "...", ... }
üíæ Inserting into Supabase...
‚úÖ Placed vitrage created in Supabase: uuid
‚úÖ Placed vitrage saved to Supabase
```

**–õ–æ–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```
üè¢ Selected object: { id: "...", name: "..." }
üìç Current plan: { id: "...", name: "..." }
üîç About to call placedVitrageStorage.create with data: {...}
üìù Creating placed vitrage: –ù–∞–∑–≤–∞–Ω–∏–µ_–í–∏—Ç—Ä–∞–∂–∞
üìã Vitrage data: { object_id: "...", floor_plan_id: "...", ... }
üíæ Inserting into Supabase...
‚ùå Supabase insert error: {...}
‚ùå Error details: {...}
‚ö†Ô∏è Exception caught: ...
‚ö†Ô∏è Using localStorage fallback to create
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: object_id undefined
**–ü—Ä–∏–∑–Ω–∞–∫:** –í –ª–æ–≥–∞—Ö `object_id: undefined`
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—ä–µ–∫—Ç –≤—ã–±—Ä–∞–Ω –≤ MainPage –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ FloorPlanEditor

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ foreign key constraint
**–ü—Ä–∏–∑–Ω–∞–∫:** Error: insert or update on table "placed_vitrages" violates foreign key constraint
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ object_id —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –æ–±—ä–µ–∫—Ç—É –≤ —Ç–∞–±–ª–∏—Ü–µ objects

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ RLS (Row Level Security)
**–ü—Ä–∏–∑–Ω–∞–∫:** Error: new row violates row-level security policy
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ RLS –≤ Supabase Dashboard

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è localStorage fallback
**–ü—Ä–∏–∑–Ω–∞–∫:** –°—Ä–∞–∑—É –≤—ã–≤–æ–¥–∏—Ç—Å—è "‚ö†Ô∏è Using localStorage fallback"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase, .env —Ñ–∞–π–ª, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Supabase

### –ß–µ—Ä–µ–∑ Supabase Dashboard
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
3. Table Editor ‚Üí placed_vitrages
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–ø–∏—Å–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤–∏—Ç—Ä–∞–∂–∞

### –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```bash
node test-supabase.js
```

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
- ‚úÖ Supabase —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–µ—Å—Ç–∞–º–∏)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –ó–∞–º–µ–Ω–µ–Ω Date.now().toString() –Ω–∞ UUID –¥–ª—è –≤—Å–µ—Ö ID
  - FloorPlanEditor.tsx - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç uuidv4() –¥–ª—è –Ω–æ–≤—ã—Ö –≤–∏—Ç—Ä–∞–∂–µ–π
  - placedVitrageStorage.ts - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç uuidv4() –≤ localStorage fallback
  - vitrageStorage.ts - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç uuidv4() –≤ localStorage fallback

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞: Invalid UUID format
**–û—à–∏–±–∫–∞:**
```
"code": "22P02",
"message": "invalid input syntax for type uuid: \"1765527391900\""
```

**–ü—Ä–∏—á–∏–Ω–∞:** ID –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å —Å –ø–æ–º–æ—â—å—é `Date.now().toString()`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ `"1765527391900"`, –Ω–æ Supabase –æ–∂–∏–¥–∞–µ—Ç UUID —Ñ–æ—Ä–º–∞—Ç–∞ `"550e8400-e29b-41d4-a716-446655440000"`.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `uuid`: `npm install uuid`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–∞–π–ª—ã: `import { v4 as uuidv4 } from 'uuid'`
3. –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `Date.now().toString()` –Ω–∞ `uuidv4()`

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏—Ç—Ä–∞–∂–µ–π –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ UUID, –∫–æ—Ç–æ—Ä—ã–µ Supabase –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å.

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
–ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤–∏—Ç—Ä–∞–∂–∞ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —á—Ç–æ–±—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É.
